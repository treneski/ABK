<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<title>Wedding Memories - Photoshoot</title>

<link href="https://fonts.googleapis.com/css2?family=Bad+Script&family=Comfortaa:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="gallery.css">
</head>

<body>

<!-- Authentication Check -->
<div class="auth-check" id="auth-check" style="display:none;">
    <div class="auth-icon"><i class="fas fa-lock fa-2x"></i></div>
    <p>Please return to the homepage to authenticate.</p>
    <a href="index.html" class="auth-link">Go to Homepage</a>
</div>

<!-- Main Content -->
<div class="main-content" id="main-content" style="display:none;">

<header class="site-header">
    <a href="categories.html" class="back-btn"><i class="fas fa-arrow-left"></i></a>
    <h1>Ангела & Благојче + Калина</h1>
    <div class="page-info" id="page-info">Loading...</div>
</header>

<div class="gallery-title">
    <i class="fas fa-camera"></i> Фотосесија - Photoshoot
</div>

<div class="photos-grid" id="photos-grid"></div>

<div id="loading" class="loading-indicator">
    <i class="fas fa-spinner fa-spin fa-3x"></i>
    <p>Loading photos from Google Drive...</p>
</div>

<div id="drive-embed-section" class="drive-embed-section" style="display:none;">
    <h3><i class="fas fa-images"></i> Browse All Photoshoot Photos</h3>
    <iframe class="drive-embed"
        src="https://drive.google.com/embeddedfolderview?id=1H0_bDBqIF0do9kqzPRTjbsVlukaM9Zoh#grid"
        loading="lazy"></iframe>
</div>

<div class="pagination" id="pagination"></div>

</div>

<!-- MODAL -->
<div id="photoModal" class="photo-modal">
    <button class="modal-close" onclick="closeModal()">
        <i class="fas fa-times"></i>
    </button>

    <div class="modal-nav">
        <button onclick="prevPhoto()"><i class="fas fa-chevron-left"></i></button>
        <button onclick="nextPhoto()"><i class="fas fa-chevron-right"></i></button>
    </div>

    <div class="modal-content">
        <img id="modalImage" src="" alt="Photo">
        <div class="modal-counter" id="modalCounter"></div>
    </div>
</div>

<script>
const DRIVE_FOLDER_ID = '1H0_bDBqIF0do9kqzPRTjbsVlukaM9Zoh';
const API_KEY = 'AIzaSyAujrb6ApGKo9STjg8ic9U8Zsht-DJ-f2c';

let drivePhotos = [];
let currentModalIndex = 0;
let currentPage = 1;
const photosPerPage = 20;

document.addEventListener('DOMContentLoaded', () => {
    sessionStorage.setItem('weddingAuth','true'); // REMOVE if already handled
    document.getElementById('main-content').style.display='block';
    initializeGallery();
});

async function initializeGallery(){
    showLoading(true);
    try{
        await loadDrivePhotos();
        displayPhotos();
    }catch(e){
        console.error(e);
        showFallbackViewer();
    }finally{
        showLoading(false);
    }
}

async function loadDrivePhotos(){
    const apiUrl = `https://www.googleapis.com/drive/v3/files?q='${DRIVE_FOLDER_ID}'+in+parents&key=${API_KEY}&fields=files(id,name,mimeType,createdTime)&orderBy=createdTime`;
    const res = await fetch(apiUrl);
    const data = await res.json();

    drivePhotos = data.files
        .filter(f => f.mimeType.startsWith('image/'))
        .map((f,i)=>({
            id:f.id,
            name:f.name,
            index:i+1,
            thumbnail:`https://drive.google.com/thumbnail?id=${f.id}&sz=w300`,
            full:`https://drive.google.com/uc?id=${f.id}`
        }));
}

function displayPhotos(){
    const grid=document.getElementById('photos-grid');
    grid.innerHTML='';
    const start=(currentPage-1)*photosPerPage;
    const end=Math.min(start+photosPerPage,drivePhotos.length);

    for(let i=start;i<end;i++){
        const p=drivePhotos[i];
        const d=document.createElement('div');
        d.className='photo-item';
        d.innerHTML=`
            <img src="${p.thumbnail}" loading="lazy">
            <div class="photo-number">${p.index}</div>
            <div class="photo-filename">${p.name}</div>
        `;
        d.onclick=()=>openModal(i);
        grid.appendChild(d);
    }
    updatePageInfo();
}

function openModal(i){
    currentModalIndex=i;
    document.getElementById('modalImage').src=drivePhotos[i].full;
    document.getElementById('modalCounter').textContent=
        `Photo ${drivePhotos[i].index} of ${drivePhotos.length}`;
    document.getElementById('photoModal').style.display='flex';
    document.body.style.overflow='hidden';
}

function closeModal(){
    document.getElementById('photoModal').style.display='none';
    document.body.style.overflow='auto';
}

function nextPhoto(){ if(currentModalIndex<drivePhotos.length-1) openModal(currentModalIndex+1); }
function prevPhoto(){ if(currentModalIndex>0) openModal(currentModalIndex-1); }

function showLoading(s){ document.getElementById('loading').style.display=s?'block':'none'; }
function showFallbackViewer(){
    document.getElementById('drive-embed-section').style.display='block';
}

document.addEventListener('keydown',e=>{
    if(document.getElementById('photoModal').style.display==='flex'){
        if(e.key==='Escape') closeModal();
        if(e.key==='ArrowRight') nextPhoto();
        if(e.key==='ArrowLeft') prevPhoto();
    }
});
</script>

</body>
</html>
